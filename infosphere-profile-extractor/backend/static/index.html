<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Profile Extractor ‚Äî InfoSphere</title>
  <meta name="description" content="Batch extract public profile info from allowed websites. LinkedIn is intentionally blocked." />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg,#0d1b2a,#1b263b 40%,#0d3b66);
      color: #e6eef6; 
      min-height:100vh;
    }
    h1,h2,h3 { font-family: 'Poppins', sans-serif; }
    /* Header */
    .header-section {
      background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      backdrop-filter: blur(8px);
      border-radius: 1.5rem;
      padding: 3rem 1rem;
      margin-bottom: 2.5rem;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
      opacity: 0;
      transform: translateY(40px);
      animation: fadeSlideUp 1s ease-out forwards;
    }
    .logo-big { width: 90px; height: 90px; margin: 0 auto 1rem; }
    /* Cards */
    .card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 1rem;
      padding: 1rem;
      backdrop-filter: blur(12px);
      transition: transform 0.25s ease, box-shadow 0.25s ease, opacity 0.4s ease;
      opacity: 0;
      transform: translateY(20px);
    }
    .card.show { opacity: 1; transform: translateY(0); }
    .card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    .btn { transition: transform 0.2s, box-shadow 0.2s; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    .text-muted { color: #9fb3c9; }
    a { color: #7fe3ef; text-decoration: underline; word-break: break-all; }
    .hidden-links { display: none; }
    .footer-logo { width: 52px; height: 52px; margin: 0 auto; }
    .avatar-fallback {
      width: 70px; height: 70px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, #06b6d4, #3b82f6);
      font-weight: bold; font-size: 1.25rem; color: #fff;
    }
    .toast {
      position: fixed; bottom: 20px; right: 20px;
      background: rgba(20,20,20,0.9); color: white;
      padding: 10px 16px; border-radius: 8px;
      font-size: 0.9rem; opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    .toast.show { opacity: 1; }
    textarea { resize: none; }
    /* Animations */
    @keyframes fadeSlideUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="p-6 lg:p-10">
  <main class="max-w-7xl mx-auto">
    
    <!-- Header -->
    <header class="header-section text-center">
      <img src="/static/logo.png" alt="Logo" class="logo-big">
      <h1 class="text-4xl lg:text-5xl font-bold tracking-tight">Profile Extractor</h1>
      <p class="mt-3 text-lg text-muted max-w-2xl mx-auto">
        Extract public profile data from blogs, GitHub, or team pages ‚Äî always respecting <code>robots.txt</code>.  
      </p>
    </header>

    <!-- Tip Section -->
    <section class="p-4 mb-6 rounded-xl bg-white/5 backdrop-blur-sm border border-white/10 flex items-start gap-3">
      <span class="text-cyan-300 text-lg">üí°</span>
      <p class="text-sm text-muted">Use blog author pages, GitHub profiles, or team pages ‚Äî avoid login-required pages.</p>
    </section>

    <!-- Input Form -->
    <section class="p-6 rounded-2xl mb-8 shadow-xl bg-white/10 backdrop-blur-lg border border-white/10">
      <form id="form" class="grid grid-cols-1 lg:grid-cols-3 gap-4">
        <div class="lg:col-span-2">
          <textarea id="urls" placeholder="https://github.com/torvalds" rows="6"
            class="w-full p-4 rounded-xl bg-transparent border border-white/20 text-white placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-cyan-400" required></textarea>
        </div>
        <div class="flex flex-col gap-3">
          <button id="submitBtn" type="submit"
            class="btn px-4 py-3 bg-gradient-to-r from-teal-300 to-cyan-400 text-black font-semibold rounded-lg shadow">Extract Profiles</button>
          <button id="exportBtn" type="button"
            class="btn px-4 py-3 bg-white/10 text-white rounded-lg disabled:opacity-50" disabled>Export JSON</button>
          <button id="clearBtn" type="button"
            class="btn px-4 py-3 bg-white/10 text-white rounded-lg">Clear</button>
        </div>
      </form>

      <!-- Loading Bar -->
      <div id="loadingBar" class="hidden mt-4">
        <div class="w-full bg-white/10 rounded-full h-2 overflow-hidden">
          <div id="loadingProgress" class="h-2 bg-gradient-to-r from-teal-300 to-cyan-400 w-0 transition-all"></div>
        </div>
        <p id="loadingText" class="text-sm text-muted mt-2">Processing...</p>
      </div>
    </section>

    <!-- Toggle -->
    <label class="inline-flex items-center gap-2 mb-6">
      <input id="toggleSuccess" type="checkbox" class="accent-teal-400" />
      <span class="text-sm text-muted">Show only successful extractions</span>
    </label>

    <!-- Results -->
    <section id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></section>

    <!-- Footer -->
    <footer class="mt-10 text-center text-muted">
      <img src="/static/logo.png" alt="Logo" class="footer-logo mb-2">
      <small>¬© 2025 InfoSphere. Built with care for public data only.</small>
    </footer>
  </main>

  <div id="toast" class="toast">‚úÖ JSON copied!</div>

  <!-- JS -->
  <script>
    const form = document.getElementById("form");
    const resultsDiv = document.getElementById("results");
    const toggleSuccess = document.getElementById("toggleSuccess");
    const loadingBar = document.getElementById("loadingBar");
    const loadingProgress = document.getElementById("loadingProgress");
    const loadingText = document.getElementById("loadingText");
    const exportBtn = document.getElementById("exportBtn");
    const clearBtn = document.getElementById("clearBtn");
    const toast = document.getElementById("toast");
    let allResults = [];

    form.addEventListener("submit", async e => {
      e.preventDefault();
      const urls = document.getElementById("urls").value.trim().split("\n").map(u => u.trim());
      allResults = [];
      resultsDiv.innerHTML = "";
      loadingBar.classList.remove("hidden");
      loadingProgress.style.width = "0%";
      loadingText.textContent = "Processing 0 / " + urls.length;

      for (let i = 0; i < urls.length; i++) {
        try {
          const res = await fetch("/api/extract", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ urls: [urls[i]] })
          });
          const data = await res.json();
          if (data.length > 0) allResults.push(data[0]);
        } catch (e) {
          allResults.push({ error: "Unexpected error", source_url: urls[i] });
        }
        loadingProgress.style.width = ((i+1)/urls.length)*100 + "%";
        loadingText.textContent = "Processing " + (i+1) + " / " + urls.length;
      }
      loadingBar.classList.add("hidden");
      renderResults();
      exportBtn.disabled = allResults.length === 0;
    });

    toggleSuccess.addEventListener("change", renderResults);

    exportBtn.addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(allResults, null, 2)], {type : 'application/json'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = "profiles.json";
      link.click();
    });

    clearBtn.addEventListener("click", () => {
      document.getElementById("urls").value = "";
      resultsDiv.innerHTML = "";
      allResults = [];
      exportBtn.disabled = true;
    });

    function renderResults() {
      const filter = toggleSuccess.checked;
      resultsDiv.innerHTML = "";
      const toShow = filter ? allResults.filter(r => r.name || r.bio || r.profile_image) : allResults;
      toShow.forEach((r, idx) => {
        const card = document.createElement("div");
        card.className = "card";

        if (r.error) {
          card.innerHTML = `<p class="text-red-400 text-sm">‚ùå ${r.error} (${r.source_url})</p>`;
          resultsDiv.appendChild(card);
          setTimeout(() => card.classList.add("show"), 50);
          return;
        }

        let shortBio = r.bio ? r.bio.split(".")[0] + "." : "No bio available";
        let profileImage = r.profile_image ? 
          `<img src="${r.profile_image}" class="mb-3 rounded-lg w-20 h-20 object-cover">` :
          `<div class="avatar-fallback mb-3">${(r.name || "?").charAt(0)}</div>`;

        let linksHTML = "";
        if (r.social_links && r.social_links.length > 0) {
          const firstLink = r.social_links[0];
          const hiddenLinks = r.social_links.slice(1).map(l => `<li><a href="${l}" target="_blank">${l}</a></li>`).join("");
          linksHTML = `
            <ul class="text-sm">
              <li><a href="${firstLink}" target="_blank">${firstLink}</a></li>
            </ul>
            ${hiddenLinks ? `<ul id="hidden-${idx}" class="text-sm hidden-links">${hiddenLinks}</ul>
            <button class="text-xs text-cyan-300 underline mt-1" onclick="toggleLinks(${idx}, this)">See More</button>` : ""}
          `;
        }

        card.innerHTML = `
          <div>
            <h3 class="text-lg font-semibold mb-1">
              ${r.name || "No Name Found"} ${r.site_name ? `¬∑ ${r.site_name}` : ""}
            </h3>
            <p class="text-sm mb-3">${shortBio}</p>
            ${profileImage}
            ${linksHTML ? `<p class="text-xs text-muted mt-2">Links:</p>${linksHTML}` : ""}
          </div>
          <div class="mt-3 flex gap-2">
            <button onclick='copyJSON(${JSON.stringify(r)})' class="btn px-3 py-1 bg-white/10 text-white text-xs rounded">Copy JSON</button>
            <a href="${r.source_url}" target="_blank" class="btn px-3 py-1 bg-gradient-to-r from-cyan-400 to-blue-500 text-black text-xs rounded">Visit Source</a>
          </div>
        `;
        resultsDiv.appendChild(card);
        setTimeout(() => card.classList.add("show"), 100 + idx * 100);
      });
    }

    function toggleLinks(id, btn) {
      const el = document.getElementById("hidden-"+id);
      if (el) {
        if (el.style.display === "block") {
          el.style.display = "none";
          btn.textContent = "See More";
        } else {
          el.style.display = "block";
          btn.textContent = "See Less";
        }
      }
    }

    function copyJSON(data) {
      navigator.clipboard.writeText(JSON.stringify(data, null, 2));
      showToast();
    }

    function showToast() {
      toast.classList.add("show");
      setTimeout(() => { toast.classList.remove("show"); }, 2000);
    }
  </script>
</body>
</html>
